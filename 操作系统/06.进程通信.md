## 进程通信

> 进程通信的几种方式

#### 管道

> 匿名管道、命名管道

- **匿名管道**
  - 无名称标识，只存在于内存之中。
  - 数据为无格式的流，并且大小受限。
  - 通信方向是单向的，双向通信需要建立两个管道。
  - 只能用于存在父子关系的进程间通信。
  - 生命周期随着进程创建而建立，随着进程终止而消失。
- **命名管道**
  - 突破了匿名管道只能存在于父子进程间的限制，在文件系统中建立文件，其他进程就可以通过这个文件与之进行通信。
- **共同点**
  - 不管是匿名管道还是命名管道，进程写入的数据都是 **缓存在内核 **中。
  - 通信数据都遵循**先进先出**原则。

#### 消息队列

- 消息队列实际上是保存在内核的 **消息链表** 。
- **消息队列** 克服了管道通信的数据是无格式的字节流的问题，消息队列的消息体是可以用户自定义的数据类型，发送数据时，会被分成一个一个独立的消息体，当然接收数据时，也要与发送方发送的消息体的数据类型保持一致，这样才能保证读取的数据是正确的。
- 消息队列通信的速度不是最及时的，毕竟 **每次数据的写入和读取都需要经过用户态与内核态之间的拷贝过程。**

#### 共享内存

- **共享内存 **可以解决消息队列通信中用户态与内核态之间数据拷贝过程带来的开销，**它直接分配一个共享空间 **，**每个进程都 可以直接访问**，就像访问进程自己的空间一样快捷方便，不需要陷入内核态或者系统调用，大大提高了通信的速度，享有 **最快** 的进程间通信方式之名。
- 便捷高效的共享内存通信，带来新的问题，多进程竞争同个共享资源会造成数据的错乱。

#### 信号量

共享内存可能存在竞争，此时可以通过 **信号量**来保护共享资源，以确保任何时刻只能有一个进程访问共享资源，这种方式就是互斥访问。信号量不仅可以实现访问的互斥性，还可以实现进程间的同步，信号量其实是一个计数器，表示的是资源个数，其值可以通过两个原子操作来控制 => PV 操作。

#### 信号

- 信号是**异步通信机制**，信号可以在应用进程和内核之间直接交互，内核也可以利用信号来通知用户空间的进程发生了哪些系统事件。
- 信号事件的来源主要有硬件来源（如键盘 ）和软件来源（如 kill 命令），一旦有信号发生，**进程有三种方式响应信号**：
  - 执行默认操作
  - 捕捉信号
  - 忽略信号

#### Socket

- 主要用于不同主机之间的通信。
- Socket 常见的三种通信方式，一个是基于 TCP 协议的通信方式，一个是基于 UDP 协议的通信方式，一个是本地进程间通信方式。
  - TCP 协议的通信。
  - UDP 协议的通信。
  - 本地进程间通信方式。