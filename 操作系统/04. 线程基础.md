## 线程基础

> 为什么需要线程、进程线程的比较

线程是进程当中的一条执行流程，同一个进程内多个线程之间可以共享代码段、数据段、打开的文件等资源，但每个线程各自都有一套独立的寄存器和栈，这样可以确保线程的控制流是相对独立的。

#### 为什么需要线程

- 进程之间通信需要额外的资源消耗。
- 维护进程的开销较大
  - 创建进程时，分配资源，建立 PCB。
  - 进程终止时，回收资源，撤销 PCB 。
  - 进程切换时，保存当前进程的信息。

线程实体之间可以并发运行，线程之间共享相同的地址空间。

#### 线程的切换

- 当两个线程不是属于同一个进程，则切换的过程就跟进程上下文切换一样。
- 当两个线程是属于同一个进程，因为虚拟内存是 **共享的**，所以在切换时，虚拟内存这些资源就 **保持不动**，只需要切换线程的私有数据、寄存器等 **不共享** 的数据。

#### 进程与线程之间的比较

- 进程是 **资源分配** 的单位，线程是 **CPU 调度** 的单位。
- 进程拥有一个完整的资源平台，而线程只独享必不可少的资源，如寄存器和栈。
- 线程的创建比进程快，因为进程在创建的过程中，还需要资源管理信息，比如内存管理信息、文件管理信息，而线程在创建的过程中，不会涉及这些资源管理信息，而是共享它们。
- 同一个进程内的线程切换比进程切换快，因为线程具有相同的地址空间。