## HTTPS

> 简介、握手过程

#### HTTPS 简介

http 是明文传输，而 https 在 http 与 TCP 协议中间加入了 **SSL/TLS** 安全协议，解决 http 存在的一些安全问题，其端口号与普通 http 的80 端口不同，为443。

##### 解决了哪些方面的安全问题

- **混合加密** 的方式保证了报文的 **机密性**。
- **摘要算法** 保证了报文的 **完整性**，解决报文被篡改的风险。
- 将服务器的公钥放入 **数字证书** 中解决被冒充的 **身份认证** 问题。

##### 保证安全的方式

- **混合加密**
  - 采用 **对称加密** 与 **非对称加密** 混合: 在通信前通过非对称加密的方式交换 **会话密钥** ，后续在通信的过程中通过 **会话密钥** 进行会话内容的加密与解密。
  - <img src="https://blog-assets-1301745442.cos.ap-nanjing.myqcloud.com/assets/image-20220515153817053.png" style="width: 400px;float:left;"  />

- **摘要算法**
  - 客户端在发送明文之前通过摘要算法得出 摘要 后，将摘要与明文一同加密发送给服务器，服务器收到后进行解密是否摘要与明文对应，若相对应则说明是完整的。
  - <img src="https://blog-assets-1301745442.cos.ap-nanjing.myqcloud.com/assets/image-20220515154323210.png" style="width: 400px;float:left;"  />

- **数字证书**

  - 客户端线从服务端获取公钥，然后用公钥加密信息，服务器收到密文后用自己的私钥解密。如何保证公钥的信任度、如何保证没被篡改？所以此时需要借助第三方机构 **CA（数字证书认证机构）**，将服务器公钥放在数字证书中，只要数字证书是可信的，公钥就是可信的。
	- <img src="https://blog-assets-1301745442.cos.ap-nanjing.myqcloud.com/assets/image-20220515154202322.png" style="width: 400px;float:left;" />

#### 握手过程

> 大致流程

##### Client Hello

- 发送客户端支持的 SSL / TLS 协议版本，如 TLS 1.2。
- 发送客户端产生随机数 Client Random，后面用于产生 **会话密钥** 。
- 发送客户端支持的密码套件列表如 RSA 加密算法。

##### Sever Hello

- 发送确认 SSL / TLS 协议版本，若浏览器不支持，则关闭加密通信。
- 发送服务端产生随机数 Client Random 用于后续生成 **会话密钥** 。
- 发送密码套件列表。
- 发送服务端的数字证书。

##### 客户端响应

- 通过操作系统或者浏览器中的 CA 的公钥，确认服务器数字证书的真实性。若没问题则会通过数字证书取出服务器公钥。然后使用该公钥加密报文，向服务器发送后续的信息。
- 发送一个随机数 **pre-master key**，该随机数会被公钥加密。
- 发送加密算法变更通知，后续将会采用 **会话密钥** 进行加密通信。
- 发送客户端握手结束通知，表示客户端的握手已经结束，同时这个阶段会把之前内容的发生的数据做个摘要以供服务端进行检验。
- 此时客户端和服务端都有之前的三个随机数，然后按照双方协定的算法 **各自生成会话密钥**。

##### 服务端响应

- 服务端在收到第三个随机数 pre-master key 之后，通过协商的加密算法计算本次通信的会话密钥，然后向服务端发送最后的信息。
- 加密算法变更通知，表示以后都用 会话密钥 进行加密通信。
- 发送服务器握手结束通知，表示服务端握手阶段的结束。并也把之前发生的数据做一个摘要，给客户端进行检验。

![image](https://blog-assets-1301745442.cos.ap-nanjing.myqcloud.com/assets/image.png)