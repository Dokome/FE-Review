## HTTP 版本

> 0.9 / 1.0 / 1.1 / 2 / 3

#### HTTP 0.9

- HTTP 0.9 是第一个版本的 HTTP 协议，它的组成极其简单。

- HTTP 协议无状态的特点在此版本已经成型。

**缺点**

- 只允许客户端发送 **GET** 这一种请求，且 **不支持请求头**。
- 由于没有协议头，造成 HTTP 0.9 只支持一种内容即文本。

#### HTTP 1.0

HTTP 1.0 为第二个版本，至今仍然广泛使用。相对于 HTTP 0.9 主要增加了如下的特性：

- 请求与响应头
- 响应对象以一个响应行开始
- 响应的内容不仅限于文本
- 开始支持 POST 方法向 Web 服务器提交数据，支持 GET, HEAD, POST 方法

**缺点**

- 短链接，请求完之后会断开连接。这导致连接无法复用，请求效率收到了一定的影响。

#### HTTP 1.1

- 使用 TCP 长连接的方式改善了 HTTP/1.0 短连接造成的性能开销。
- 支持管道（pipeline）网络传输，只要第一个请求发出去了，不必等其回来，就可以发第二个请求出去，可以减少整体的响应时间。
- 新增了一批 **Request method**：OPTIONS 、PUT 、DELETE 、TRACE 、CONNECT 方法。
- **缓存处理**：增加了一些新的缓存字段 引入了实体标签 **e-tags** 和 **Cache-Control** 头部。
- 允许数据分块 (chunked) 利于传输大文件。

**缺点**

- 请求 / 响应头部（Header）未经压缩就发送，首部信息越多延迟越大。只能压缩 Body 的部分；
- 发送冗长的首部。每次互相发送相同的首部造成的浪费较多；
- 服务器是按请求的顺序响应的，如果服务器响应慢，会招致客户端一直请求不到数据，也就是队头阻塞；
- 没有请求优先级控制；
- 请求只能从客户端开始，服务器只能被动响应。

#### HTTP 2

- **多路复用：**可以在一个连接中发送多个并发的请求或响应，而且不需按照顺序一一对应。移除了 1.1 中的串行请求，无需排队等待，也就解决了队首阻塞问题，提高了连接的利用率。
- **服务端推送：**一定程度上改善了原来的 请求-应答 模式，服务器不再是被动的响应，可以进行主动的推送，必入可以将网站的某些资源文件推送给客户端，而无需等待页面解析到响应部分再继续请求。
- **头部压缩：**如果多次发送的报文头部是类似或相同的，那么协议会帮助消除重复的部分。这就是 HPACK 算法：在客户端和服务端同时维护一张表，所有字段都会存入这张表并有与之对应的索引，后续发送相同的内容的时候可以只使用索引了。
- **二进制分帧：**不再像 1.1 中一样使用纯文本形式的报文，而是全面采用了二进制的格式，头部信息和数据体都是二进制，并且统称为帧 -- 头信息帧 和 数据帧，收到报文后无需将明文再转换为二进制，提高了效率。

<img src="https://blog-assets-1301745442.cos.ap-nanjing.myqcloud.com/assets/image-20220513192641703.png" style="width:600px;float:left"/>

**缺点**

HTTP/2 通过 Stream 的并发能力，解决了 HTTP/1 队头阻塞的问题，看似很完美了，但是 HTTP/2 还是存在 **队头阻塞** 的问题，只不过问题不是在 HTTP 这一层面，而是在 TCP 这一层。

HTTP/2 是基于 TCP 协议来传输数据的，TCP 是字节流协议，TCP 层必须保证收到的字节数据是完整且连续的，这样内核才会将缓冲区里的数据返回给 HTTP 应用，那么当 **前 1 个字节数据** 没有到达时，后收到的字节数据只能存放在内核缓冲区里，只有等到这 1 个字节数据到达时，HTTP/2 应用层才能从内核中拿到数据，这就是 HTTP/2 队头阻塞问题。

如果发生了丢包现象，就会触发 TCP 的重传机制，这样在一个 TCP 连接中的 **所有的 HTTP 请求都必须等待这个丢了的包被重传回来 **。

#### HTTP 3

- **无队首阻塞：**HTTP 3 使用的是基于 UDP 的 QUIC 协议实现类似 TCP 的可靠传输，UDP 发生是不管顺序，也不管丢包的，所以不会出现像 HTTP/2 队头阻塞的问题。
	- QUIC 有自己的一套机制可以保证传输的可靠性的。**当某个流发生丢包时，只会阻塞这个流，其他流不会受到影响，因此不存在队头阻塞问题**。这与 HTTP/2 不同，HTTP/2 只要某个流中的数据包丢失了，其他流也会因此受影响。

	- <img src="https://blog-assets-1301745442.cos.ap-nanjing.myqcloud.com/assets/image-20220513193432089.png" style="width:600px;float:left"/>

- **更快连接的建立：**HTTP 1 和 HTTP 2 中的 TCP 和 TLS 是 **分层的** ，他们需要分批次来握手，先 TCP 握手再 TLS 握手，HTTP 3 在传输数据前虽然需要 QUIC 协议握手，这个握手过程只需要 1 RTT，握手的目的是为确认双方的 **连接 ID**，连接迁移就是基于连接 ID 实现的。
  -  HTTP / 3 的 QUIC 协议并不是与 TLS 分层，而是QUIC 内部包含了 TLS，它在自己的帧会携带 TLS 里的 “记录”，再加上 QUIC 使用的是 TLS / 1.3，因此仅需 1 个 RTT 就可以 **同时** 完成建立连接与密钥协
  -  <img src="https://blog-assets-1301745442.cos.ap-nanjing.myqcloud.com/assets/image-20220513194114689.png" style="width:600px;float:left"/>

